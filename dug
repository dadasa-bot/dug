local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CameraLockGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Create TextButton
local textButton = Instance.new("TextButton")
textButton.Name = "LockButton"
textButton.Size = UDim2.new(0, 200, 0, 50)
textButton.Position = UDim2.new(0.5, -100, 0.5, -25)
textButton.Text = "Lock Camera"
textButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
textButton.TextColor3 = Color3.new(1, 1, 1)
textButton.Font = Enum.Font.SourceSans
textButton.TextSize = 24
textButton.Active = true
textButton.Draggable = true
textButton.Parent = screenGui

-- Add rounded corners
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 12)
uiCorner.Parent = textButton

-- State
local isLocked = false
local lockedTarget = nil
local connection = nil

-- Function to find nearest player
local function getNearestPlayer()
	local myChar = LocalPlayer.Character
	if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then return nil end

	local closestPlayer = nil
	local closestDistance = math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (player.Character.HumanoidRootPart.Position - myChar.HumanoidRootPart.Position).Magnitude
			if dist < closestDistance then
				closestDistance = dist
				closestPlayer = player
			end
		end
	end

	return closestPlayer
end

-- Click to toggle camera lock
textButton.MouseButton1Click:Connect(function()
	if not isLocked then
		local target = getNearestPlayer()
		if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
			lockedTarget = target
			Camera.CameraType = Enum.CameraType.Scriptable
			textButton.Text = "Unlock Camera"
			print("Locked camera on: " .. target.Name)

			connection = RunService.RenderStepped:Connect(function()
				if lockedTarget and lockedTarget.Character and lockedTarget.Character:FindFirstChild("HumanoidRootPart") then
					local root = lockedTarget.Character.HumanoidRootPart
					local offset = Vector3.new(0, 5, -12) -- Position the camera behind and above
					Camera.CFrame = CFrame.new(root.Position + offset, root.Position)
				end
			end)

			isLocked = true
		else
			print("No nearby player to follow.")
		end
	else
		-- Unlock camera
		if connection then connection:Disconnect() end
		Camera.CameraType = Enum.CameraType.Custom
		textButton.Text = "Lock Camera"
		print("Camera unlocked.")
		isLocked = false
		lockedTarget = nil
	end
end)

